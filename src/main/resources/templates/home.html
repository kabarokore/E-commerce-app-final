<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="_csrf" th:content="${_csrf != null ? _csrf.token : ''}" />
    <meta
      name="_csrf_header"
      th:content="${_csrf != null ? _csrf.headerName : ''}"
    />
    <title>The Daily Grind | Premium Coffee & Brewing Equipment</title>
    <link rel="stylesheet" th:href="@{/css/home.css}" />
    <link rel="stylesheet" th:href="@{/css/modal.css}" />
    <link rel="stylesheet" th:href="@{/css/cart-animation.css}" />
    <link rel="stylesheet" th:href="@{/css/cart-counter.css}" />
    <!----->
    <link rel="stylesheet" th:href="@{/css/navigation.css}" />
    <!------->
    <script th:src="@{/js/cart-counter.js}"></script>
    <script th:src="@{/js/counter-unified.js}"></script>
    <link
      rel="shortcut icon"
      href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQhUILeMJj0BMi46FwrjfgJHUcOSw4POtCsjg&s"
      type="image/x-icon"
    />
  </head>
  <body>
    <div class="overlay" data-overlay></div>

    <header>
      <div class="header-top">
        <div class="container">
          <ul class="header-social-container">
            <li>
              <a href="#" class="social-link"
                ><ion-icon name="logo-facebook"></ion-icon
              ></a>
            </li>
            <li>
              <a href="#" class="social-link"
                ><ion-icon name="logo-twitter"></ion-icon
              ></a>
            </li>
            <li>
              <a href="#" class="social-link"
                ><ion-icon name="logo-instagram"></ion-icon
              ></a>
            </li>
            <li>
              <a href="#" class="social-link"
                ><ion-icon name="logo-linkedin"></ion-icon
              ></a>
            </li>
          </ul>

          <div class="header-alert-news">
            <p><b>Free Shipping</b> This week Order Over - $35</p>
          </div>

          <div class="header-top-actions">
            <select name="currency">
              <option value="usd">USD &dollar;</option>
              <option value="eur">EUR &euro;</option>
            </select>

            <select name="language">
              <option value="en-US">English</option>
              <option value="es-ES">Espa&ntilde;ol</option>
              <option value="fr">Fran&ccedil;ais</option>
            </select>
          </div>
        </div>
      </div>

      <div class="header-main">
        <div class="container">
          <a href="#" class="header-logo"
            ><h1 style="font-size: 1.8rem; color: var(--coffee-dark)">
              The Daily Grind
            </h1></a
          >

          <div class="header-search-container">
            <input
              type="search"
              name="search"
              class="search-field"
              placeholder="Search for coffee, equipment, etc."
            />
            <button class="search-btn">
              <ion-icon name="search-outline"></ion-icon>
            </button>
          </div>

          <div class="header-user-actions">
            <button class="action-btn">
              <ion-icon name="person-outline"></ion-icon>
            </button>
            <a href="/wishlist" class="action-btn wishlist-btn">
              <ion-icon name="heart-outline"></ion-icon>
              <span
                class="count"
                th:text="${wishlistItemCount != null ? wishlistItemCount : '0'}"
                >0</span
              >
              <div class="wishlist-tooltip">View Wishlist</div>
              <!-- Mini Wishlist Preview -->
              <div class="mini-wishlist-preview">
                <div class="mini-wishlist-header">
                  <h4>Your Wishlist</h4>
                </div>
                <div class="mini-wishlist-items">
                  <!-- Items will be loaded dynamically -->
                  <div class="mini-wishlist-empty">Your wishlist is empty</div>
                </div>
                <div class="mini-wishlist-footer">
                  <a href="/wishlist" class="mini-wishlist-button"
                    >View Wishlist</a
                  >
                </div>
              </div>
            </a>
            <a href="/cart" class="action-btn cart-btn">
              <ion-icon name="bag-handle-outline"></ion-icon>
              <span
                class="count cart-counter"
                th:text="${cartItemCount != null ? cartItemCount : '0'}"
                >0</span
              >
              <div class="cart-tooltip">View Cart</div>
              <!-- Mini Cart Preview -->
              <div class="mini-cart-preview">
                <div class="mini-cart-header">
                  <h4>Your Cart</h4>
                </div>
                <div class="mini-cart-items">
                  <!-- Items will be loaded dynamically -->
                  <div class="mini-cart-empty">Your cart is empty</div>
                </div>
                <div class="mini-cart-footer">
                  <a href="/cart" class="mini-cart-button">View Cart</a>
                  <a href="/checkout" class="mini-cart-button checkout"
                    >Checkout</a
                  >
                </div>
              </div>
            </a>
          </div>
        </div>
      </div>

      <nav class="desktop-navigation-menu">
        <div class="container">
          <ul class="desktop-menu-category-list">
            <li class="menu-category">
              <a href="#" class="menu-title">Home</a>
            </li>
            <li class="menu-category">
              <a href="#" class="menu-title">Coffee Beans</a>
            </li>
            <li class="menu-category">
              <a href="#" class="menu-title">Brewing Equipment</a>
            </li>
            <li class="menu-category">
              <a href="#" class="menu-title">Accessories</a>
            </li>
            <li class="menu-category">
              <a href="#" class="menu-title">Subscriptions</a>
            </li>
            <li class="menu-category">
              <a href="#" class="menu-title">Blog</a>
            </li>
            <li class="menu-category">
              <a href="#" class="menu-title">Special Offers</a>
            </li>
          </ul>
        </div>
      </nav>

      <div class="mobile-bottom-navigation">
        <a th:href="@{/orders}" class="action-btn cart-btn">
          <button class="action-btn" data-mobile-menu-open-btn>
            <ion-icon name="menu-outline"></ion-icon>
          </button>
        </a>
        <a th:href="@{/cart}" class="action-btn cart-btn">
          <ion-icon name="bag-handle-outline"></ion-icon>
          <span
            class="count cart-counter"
            th:text="${cartItemCount != null ? cartItemCount : '0'}"
            >0</span
          >
        </a>
        <a th:href="@{/}" class="action-btn">
          <ion-icon name="home-outline"></ion-icon>
        </a>
        <a th:href="@{/wishlist}" class="action-btn wishlist-btn">
          <ion-icon name="heart-outline"></ion-icon>
          <span
            class="count wishlist-counter"
            th:text="${wishlistItemCount != null ? wishlistItemCount : '0'}"
            >0</span
          >
          <div class="wishlist-tooltip">View Wishlist</div>
        </a>
        <a th:href="@{/products}" class="action-btn">
          <ion-icon name="grid-outline"></ion-icon>
        </a>
        <div class="mobile-menu-dropdown">
          <button class="action-btn mobile-menu-dropdown-btn">
            <ion-icon name="ellipsis-vertical-outline"></ion-icon>
          </button>
          <div class="mobile-dropdown-content">
            <a th:href="@{/profile}" sec:authorize="isAuthenticated()">
              <ion-icon name="person-outline"></ion-icon> Profile
            </a>
            <a th:href="@{/about}">
              <ion-icon name="information-circle-outline"></ion-icon> About Us
            </a>
            <form
              th:action="@{/logout}"
              method="post"
              sec:authorize="isAuthenticated()"
            >
              <button type="submit" class="dropdown-menu-button">
                <ion-icon name="log-out-outline"></ion-icon> Logout
              </button>
            </form>
            <a th:href="@{/login}" sec:authorize="!isAuthenticated()">
              <ion-icon name="log-in-outline"></ion-icon> Login
            </a>
          </div>
        </div>
      </div>
    </header>

    <main>
      <div class="banner">
        <div class="container">
          <div class="slider-container has-scrollbar">
            <div class="slider-item">
              <img
                src="https://images.unsplash.com/photo-1497935586351-b67a49e012bf?q=80&w=1171&auto=format&fit=crop"
                alt="specialty coffee beans"
                class="banner-img"
              />
              <div class="banner-content">
                <p class="banner-subtitle">Premium Selection</p>
                <h2 class="banner-title">Ethically Sourced Coffee Beans</h2>
                <p class="banner-text">Starting at &dollar; <b>12</b>.99</p>
                <a href="#" class="banner-btn">Shop Now</a>
              </div>
            </div>

            <div class="slider-item">
              <img
                src="https://images.unsplash.com/photo-1510591509098-f4fdc6d0ff04?q=80&w=1170&auto=format&fit=crop"
                alt="brewing equipment"
                class="banner-img"
              />
              <div class="banner-content">
                <p class="banner-subtitle">Professional Equipment</p>
                <h2 class="banner-title">Elevate Your Home Brewing</h2>
                <p class="banner-text">Starting at &dollar; <b>29</b>.99</p>
                <a href="#" class="banner-btn">Shop Now</a>
              </div>
            </div>

            <div class="slider-item">
              <img
                src="https://images.unsplash.com/photo-1512568400610-62da28bc8a13?q=80&w=1374&auto=format&fit=crop"
                alt="coffee subscription boxes"
                class="banner-img"
              />
              <div class="banner-content">
                <p class="banner-subtitle">Monthly Delivery</p>
                <h2 class="banner-title">Coffee Subscription Boxes</h2>
                <p class="banner-text">Starting at &dollar; <b>19</b>.99</p>
                <a href="#" class="banner-btn">Shop Now</a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="category">
        <div class="container">
          <div class="category-item-container has-scrollbar">
            <div class="category-item">
              <div class="category-img-box">
                <img
                  src="https://cdn-icons-png.flaticon.com/512/4552/4552181.png"
                  alt="coffee beans"
                  width="30"
                />
              </div>
              <div class="category-content-box">
                <div class="category-content-flex">
                  <h3 class="category-item-title">Coffee Beans</h3>
                  <p class="category-item-amount">(53)</p>
                </div>
                <a
                  href="javascript:void(0);"
                  class="category-btn"
                  onclick="openCategoryModal('coffee-beans'); return false;"
                  >Show All</a
                >
              </div>
            </div>

            <div class="category-item">
              <div class="category-img-box">
                <img
                  src="https://cdn-icons-png.flaticon.com/512/2935/2935387.png"
                  alt="brewing equipment"
                  width="30"
                />
              </div>
              <div class="category-content-box">
                <div class="category-content-flex">
                  <h3 class="category-item-title">Brewing Equipment</h3>
                  <p class="category-item-amount">(68)</p>
                </div>
                <a
                  href="javascript:void(0);"
                  class="category-btn"
                  onclick="openCategoryModal('brewing-equipment'); return false;"
                  >Show All</a
                >
              </div>
            </div>

            <div class="category-item">
              <div class="category-img-box">
                <img
                  src="https://cdn-icons-png.flaticon.com/512/924/924514.png"
                  alt="coffee mugs"
                  width="30"
                />
              </div>
              <div class="category-content-box">
                <div class="category-content-flex">
                  <h3 class="category-item-title">Mugs & Tumblers</h3>
                  <p class="category-item-amount">(35)</p>
                </div>
                <a
                  href="javascript:void(0);"
                  class="category-btn"
                  onclick="openCategoryModal('mugs-tumblers'); return false;"
                  >Show All</a
                >
              </div>
            </div>

            <div class="category-item">
              <div class="category-img-box">
                <img
                  src="https://cdn-icons-png.flaticon.com/512/7566/7566207.png"
                  alt="subscription boxes"
                  width="30"
                />
              </div>
              <div class="category-content-box">
                <div class="category-content-flex">
                  <h3 class="category-item-title">Subscription Boxes</h3>
                  <p class="category-item-amount">(27)</p>
                </div>
                <a
                  href="javascript:void(0);"
                  class="category-btn"
                  onclick="openCategoryModal('subscription-boxes'); return false;"
                  >Show All</a
                >
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="product-container">
        <div class="container">
          <div class="product-box">
            <div class="product-minimal">
              <div class="product-showcase">
                <h2 class="title">New Arrivals</h2>
                <div class="showcase-wrapper has-scrollbar">
                  <div class="showcase-container">
                    <div class="showcase" th:id="'product-' + 101">
                      <a th:href="@{/products/101}" class="showcase-img-box">
                        <img
                          th:src="@{https://images.unsplash.com/photo-1611854779393-1b2da9d400fe?q=80&w=1374&auto=format&fit=crop}"
                          alt="Ethiopian Yirgacheffe Light Roast"
                          class="showcase-img"
                          width="70"
                        />
                      </a>
                      <div class="showcase-content">
                        <a th:href="@{/products/101}"
                          ><h4 class="showcase-title">
                            Ethiopian Yirgacheffe Light Roast
                          </h4></a
                        >
                        <span class="showcase-category">Specialty Coffee</span>
                        <div class="price-box">
                          <p class="price">$18.99</p>
                          <del>$22.00</del>
                        </div>
                      </div>
                    </div>

                    <div class="showcase" th:id="'product-' + 102">
                      <a th:href="@{/products/102}" class="showcase-img-box">
                        <img
                          th:src="@{https://images.unsplash.com/photo-1570286424717-86d8a0082d0c?q=80&w=1480&auto=format&fit=crop}"
                          alt="Stainless Steel Pour-Over Kettle"
                          class="showcase-img"
                          width="70"
                        />
                      </a>
                      <div class="showcase-content">
                        <a th:href="@{/products/102}"
                          ><h4 class="showcase-title">
                            Stainless Steel Pour-Over Kettle
                          </h4></a
                        >
                        <span class="showcase-category">Brewing Equipment</span>
                        <div class="price-box">
                          <p class="price">$32.50</p>
                          <del>$39.99</del>
                        </div>
                      </div>
                    </div>

                    <div class="showcase" th:id="'product-' + 103">
                      <a th:href="@{/products/103}" class="showcase-img-box">
                        <img
                          th:src="@{https://images.unsplash.com/photo-1564890369478-c89ca6d9cde9?q=80&w=1470&auto=format&fit=crop}"
                          alt="Burundi Medium Roast Coffee"
                          class="showcase-img"
                          width="70"
                        />
                      </a>
                      <div class="showcase-content">
                        <a th:href="@{/products/103}"
                          ><h4 class="showcase-title">
                            Burundi Medium Roast Coffee
                          </h4></a
                        >
                        <span class="showcase-category">Specialty Coffee</span>
                        <div class="price-box">
                          <p class="price">$16.99</p>
                          <del>$19.50</del>
                        </div>
                      </div>
                    </div>

                    <div class="showcase" th:id="'product-' + 104">
                      <a th:href="@{/products/104}" class="showcase-img-box">
                        <img
                          th:src="@{https://images.unsplash.com/photo-1607681034540-2c46cc71896d?q=80&w=1374&auto=format&fit=crop}"
                          alt="Vacuum Coffee Maker"
                          class="showcase-img"
                          width="70"
                        />
                      </a>
                      <div class="showcase-content">
                        <a th:href="@{/products/104}"
                          ><h4 class="showcase-title">
                            Vacuum Coffee Maker
                          </h4></a
                        >
                        <span class="showcase-category">Brewing Equipment</span>
                        <div class="price-box">
                          <p class="price">$45.99</p>
                          <del>$59.99</del>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="product-main">
              <h2 class="title">Featured Products</h2>
              <div class="product-grid">
                <div class="showcase" th:id="'product-' + 201">
                  <div class="showcase-banner">
                    <img
                      th:src="@{https://images.unsplash.com/photo-1610889556528-9a770e32642f?q=80&w=1315&auto=format&fit=crop}"
                      alt="Colombian Single Origin Coffee Beans"
                      class="product-img default"
                      width="300"
                    />
                    <img
                      th:src="@{https://images.unsplash.com/photo-1610889556528-9a770e32642f?q=80&w=1315&auto=format&fit=crop}"
                      alt="Colombian Single Origin Coffee Beans"
                      class="product-img hover"
                      width="300"
                    />
                    <p class="showcase-badge">15%</p>
                    <div class="showcase-actions">
                      <button
                        class="btn-action"
                        th:onclick="'addToWishlist(' + 201 + ')'"
                      >
                        <ion-icon name="heart-outline"></ion-icon>
                      </button>
                      <button
                        class="btn-action"
                        th:onclick="'quickView(' + 201 + ')'"
                      >
                        <ion-icon name="eye-outline"></ion-icon>
                      </button>
                      <button
                        class="btn-action"
                        th:onclick="'addToCart(' + 201 + ')'"
                      >
                        <ion-icon name="bag-add-outline"></ion-icon>
                      </button>
                    </div>
                  </div>
                  <div class="showcase-content">
                    <span class="showcase-category">Coffee Beans</span>
                    <a th:href="@{/products/201}"
                      ><h3 class="showcase-title">
                        Colombian Single Origin Coffee Beans
                      </h3></a
                    >
                    <div class="showcase-rating">
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star-outline"></ion-icon>
                    </div>
                    <div class="price-box">
                      <p class="price">$14.99</p>
                      <del>$17.50</del>
                    </div>
                  </div>
                </div>

                <div class="showcase" th:id="'product-' + 202">
                  <div class="showcase-banner">
                    <img
                      th:src="@{https://images.unsplash.com/photo-1708127368781-cd5f069a90a5?w=400&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8ZnJlbmNoJTIwcHJlc3N8ZW58MHx8MHx8fDA%3D}"
                      alt="French Press Coffee Maker"
                      class="product-img default"
                      width="300"
                    />
                    <img
                      th:src="@{https://images.unsplash.com/photo-1609902980959-8fc750449b73?w=400&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8N3x8ZnJlbmNoJTIwcHJlc3N8ZW58MHx8MHx8fDA%3D}"
                      alt="French Press Coffee Maker"
                      class="product-img hover"
                      width="300"
                    />
                    <p class="showcase-badge angle black">Sale</p>
                    <div class="showcase-actions">
                      <button
                        class="btn-action"
                        th:onclick="'addToWishlist(' + 202 + ')'"
                      >
                        <ion-icon name="heart-outline"></ion-icon>
                      </button>
                      <button
                        class="btn-action"
                        th:onclick="'quickView(' + 202 + ')'"
                      >
                        <ion-icon name="eye-outline"></ion-icon>
                      </button>
                      <button
                        class="btn-action"
                        th:onclick="'addToCart(' + 202 + ')'"
                      >
                        <ion-icon name="bag-add-outline"></ion-icon>
                      </button>
                    </div>
                  </div>
                  <div class="showcase-content">
                    <span class="showcase-category">Brewing Equipment</span>
                    <a th:href="@{/products/202}"
                      ><h3 class="showcase-title">
                        French Press Coffee Maker 34oz
                      </h3></a
                    >
                    <div class="showcase-rating">
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star-outline"></ion-icon>
                    </div>
                    <div class="price-box">
                      <p class="price">$28.99</p>
                      <del>$36.00</del>
                    </div>
                  </div>
                </div>

                <div class="showcase" th:id="'product-' + 203">
                  <div class="showcase-banner">
                    <img
                      th:src="@{https://images.unsplash.com/photo-1519682337058-a94d519337bc?q=80&w=1470&auto=format&fit=crop}"
                      alt="Ceramic Coffee Mug Set"
                      class="product-img default"
                      width="300"
                    />
                    <img
                      th:src="@{https://images.unsplash.com/photo-1514228742587-6b1558fcca3d?q=80&w=1470&auto=format&fit=crop}"
                      alt="Ceramic Coffee Mug Set"
                      class="product-img hover"
                      width="300"
                    />
                    <p class="showcase-badge angle pink">NEW</p>
                    <div class="showcase-actions">
                      <button
                        class="btn-action"
                        th:onclick="'addToWishlist(' + 203 + ')'"
                      >
                        <ion-icon name="heart-outline"></ion-icon>
                      </button>
                      <button
                        class="btn-action"
                        th:onclick="'quickView(' + 203 + ')'"
                      >
                        <ion-icon name="eye-outline"></ion-icon>
                      </button>
                      <button
                        class="btn-action"
                        th:onclick="'addToCart(' + 203 + ')'"
                      >
                        <ion-icon name="bag-add-outline"></ion-icon>
                      </button>
                    </div>
                  </div>
                  <div class="showcase-content">
                    <span class="showcase-category">Accessories</span>
                    <a th:href="@{/products/203}"
                      ><h3 class="showcase-title">
                        Ceramic Coffee Mug Set (Set of 4)
                      </h3></a
                    >
                    <div class="showcase-rating">
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star-half-outline"></ion-icon>
                    </div>
                    <div class="price-box">
                      <p class="price">$24.99</p>
                      <del>$32.00</del>
                    </div>
                  </div>
                </div>

                <div class="showcase" th:id="'product-' + 204">
                  <div class="showcase-banner">
                    <img
                      th:src="@{https://images.unsplash.com/photo-1544787219-7f47ccb76574?q=80&w=1471&auto=format&fit=crop}"
                      alt="Coffee Subscription Box"
                      class="product-img default"
                      width="300"
                    />
                    <img
                      th:src="@{https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?q=80&w=1470&auto=format&fit=crop}"
                      alt="Coffee Subscription Box"
                      class="product-img hover"
                      width="300"
                    />
                    <div class="showcase-actions">
                      <button
                        class="btn-action"
                        th:onclick="'addToWishlist(' + 204 + ')'"
                      >
                        <ion-icon name="heart-outline"></ion-icon>
                      </button>
                      <button
                        class="btn-action"
                        th:onclick="'quickView(' + 204 + ')'"
                      >
                        <ion-icon name="eye-outline"></ion-icon>
                      </button>
                      <button
                        class="btn-action"
                        th:onclick="'addToCart(' + 204 + ')'"
                      >
                        <ion-icon name="bag-add-outline"></ion-icon>
                      </button>
                    </div>
                  </div>
                  <div class="showcase-content">
                    <span class="showcase-category">Subscription</span>
                    <a th:href="@{/products/204}"
                      ><h3 class="showcase-title">
                        Monthly Coffee Explorer Box
                      </h3></a
                    >
                    <div class="showcase-rating">
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star"></ion-icon>
                    </div>
                    <div class="price-box">
                      <p class="price">$29.99</p>
                      <del>$35.00</del>
                    </div>
                  </div>
                </div>

                <div class="showcase" th:id="'product-' + 205">
                  <div class="showcase-banner">
                    <img
                      th:src="@{https://images.unsplash.com/photo-1670950444753-805b4fb5a00e?q=80&w=1374&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D}"
                      alt="AeroPress Coffee Maker Kit"
                      class="product-img default"
                      width="300"
                    />
                    <img
                      th:src="@{https://images.unsplash.com/photo-1712664436444-746b20ec5d8f?q=80&w=1470&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D}"
                      alt="AeroPress Coffee Maker Kit"
                      class="product-img hover"
                      width="300"
                    />
                    <p class="showcase-badge">20%</p>
                    <div class="showcase-actions">
                      <button
                        class="btn-action"
                        th:onclick="'addToWishlist(' + 205 + ')'"
                      >
                        <ion-icon name="heart-outline"></ion-icon>
                      </button>
                      <button
                        class="btn-action"
                        th:onclick="'quickView(' + 205 + ')'"
                      >
                        <ion-icon name="eye-outline"></ion-icon>
                      </button>
                      <button
                        class="btn-action"
                        th:onclick="'addToCart(' + 205 + ')'"
                      >
                        <ion-icon name="bag-add-outline"></ion-icon>
                      </button>
                    </div>
                  </div>
                  <div class="showcase-content">
                    <span class="showcase-category">Brewing Equipment</span>
                    <a th:href="@{/products/205}"
                      ><h3 class="showcase-title">
                        AeroPress Coffee Maker Kit
                      </h3></a
                    >
                    <div class="showcase-rating">
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star-half-outline"></ion-icon>
                    </div>
                    <div class="price-box">
                      <p class="price">$31.99</p>
                      <del>$39.99</del>
                    </div>
                  </div>
                </div>

                <div class="showcase" th:id="'product-' + 206">
                  <div class="showcase-banner">
                    <img
                      th:src="@{https://images.unsplash.com/photo-1509042239860-f550ce710b93?q=80&w=1374&auto=format&fit=crop}"
                      alt="Handcrafted Wooden Coffee Scoop"
                      class="product-img default"
                      width="300"
                    />
                    <img
                      th:src="@{https://images.unsplash.com/photo-1580933073521-dc49ac0d4e6a?q=80&w=1469&auto=format&fit=crop}"
                      alt="Handcrafted Wooden Coffee Scoop"
                      class="product-img hover"
                      width="300"
                    />
                    <div class="showcase-actions">
                      <button
                        class="btn-action"
                        th:onclick="'addToWishlist(' + 206 + ')'"
                      >
                        <ion-icon name="heart-outline"></ion-icon>
                      </button>
                      <button
                        class="btn-action"
                        th:onclick="'quickView(' + 206 + ')'"
                      >
                        <ion-icon name="eye-outline"></ion-icon>
                      </button>
                      <button
                        class="btn-action"
                        th:onclick="'addToCart(' + 206 + ')'"
                      >
                        <ion-icon name="bag-add-outline"></ion-icon>
                      </button>
                    </div>
                  </div>
                  <div class="showcase-content">
                    <span class="showcase-category">Accessories</span>
                    <a th:href="@{/products/206}"
                      ><h3 class="showcase-title">
                        Handcrafted Wooden Coffee Scoop
                      </h3></a
                    >
                    <div class="showcase-rating">
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star"></ion-icon>
                      <ion-icon name="star-outline"></ion-icon>
                    </div>
                    <div class="price-box">
                      <p class="price">$12.99</p>
                      <del>$15.00</del>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div>
        <div class="container">
          <div class="testimonials-box">
            <div class="testimonial">
              <h2 class="title">Testimonials</h2>
              <div class="testimonial-card">
                <img
                  src="https://randomuser.me/api/portraits/women/42.jpg"
                  alt="Sarah Johnson"
                  class="testimonial-banner"
                  width="80"
                  height="80"
                />
                <h3 class="testimonial-name">Sarah Johnson</h3>
                <p class="testimonial-title">Coffee Enthusiast</p>
                <img
                  src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/icons/quote.svg"
                  alt="quotation"
                  class="quotation-img"
                  width="30"
                />
                <p class="testimonial-desc">
                  "I've tried many coffee subscriptions, but The Daily Grind
                  offers the best selection and freshest beans. Their Ethiopian
                  Yirgacheffe is absolutely divine!"
                </p>
              </div>
            </div>

            <div class="service">
              <h2 class="title">Our Services</h2>
              <div class="service-container">
                <div class="service-item">
                  <div class="service-icon">
                    <ion-icon name="boat-outline"></ion-icon>
                  </div>
                  <div class="service-content">
                    <h3 class="service-title">Free Shipping</h3>
                    <p class="service-desc">
                      Free shipping on all orders over $35.
                    </p>
                  </div>
                </div>

                <div class="service-item">
                  <div class="service-icon">
                    <ion-icon name="rocket-outline"></ion-icon>
                  </div>
                  <div class="service-content">
                    <h3 class="service-title">Fast Delivery</h3>
                    <p class="service-desc">
                      Packages ship within 24 hours of ordering.
                    </p>
                  </div>
                </div>

                <div class="service-item">
                  <div class="service-icon">
                    <ion-icon name="call-outline"></ion-icon>
                  </div>
                  <div class="service-content">
                    <h3 class="service-title">24/7 Support</h3>
                    <p class="service-desc">
                      Get assistance whenever you need it.
                    </p>
                  </div>
                </div>

                <div class="service-item">
                  <div class="service-icon">
                    <ion-icon name="return-down-back-outline"></ion-icon>
                  </div>
                  <div class="service-content">
                    <h3 class="service-title">Easy Returns</h3>
                    <p class="service-desc">
                      30-day money-back guarantee on all products.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Category Modals -->
    <div id="coffee-beans-modal" class="modal">
      <div class="modal-content">
        <span class="close-modal">&times;</span>
        <div class="modal-header">
          <h2>Coffee Beans</h2>
        </div>
        <div class="modal-products">
          <!-- Product items will be dynamically loaded -->
          <div class="modal-loading">
            <div class="spinner"></div>
          </div>
        </div>
        <div class="modal-pagination"></div>
      </div>
    </div>

    <div id="brewing-equipment-modal" class="modal">
      <div class="modal-content">
        <span class="close-modal">&times;</span>
        <div class="modal-header">
          <h2>Brewing Equipment</h2>
        </div>
        <div class="modal-products">
          <!-- Product items will be dynamically loaded -->
          <div class="modal-loading">
            <div class="spinner"></div>
          </div>
        </div>
        <div class="modal-pagination"></div>
      </div>
    </div>

    <div id="mugs-tumblers-modal" class="modal">
      <div class="modal-content">
        <span class="close-modal">&times;</span>
        <div class="modal-header">
          <h2>Mugs & Tumblers</h2>
        </div>
        <div class="modal-products">
          <!-- Product items will be dynamically loaded -->
          <div class="modal-loading">
            <div class="spinner"></div>
          </div>
        </div>
        <div class="modal-pagination"></div>
      </div>
    </div>

    <div id="subscription-boxes-modal" class="modal">
      <div class="modal-content">
        <span class="close-modal">&times;</span>
        <div class="modal-header">
          <h2>Subscription Boxes</h2>
        </div>
        <div class="modal-products">
          <!-- Product items will be dynamically loaded -->
          <div class="modal-loading">
            <div class="spinner"></div>
          </div>
        </div>
        <div class="modal-pagination"></div>
      </div>
    </div>

    <footer>
      <div class="footer-nav">
        <div class="container">
          <ul class="footer-nav-list">
            <li class="footer-nav-item">
              <h2 class="nav-title">Popular Categories</h2>
            </li>
            <li class="footer-nav-item">
              <a href="#" class="footer-nav-link">Single Origin Beans</a>
            </li>
            <li class="footer-nav-item">
              <a href="#" class="footer-nav-link">Espresso Machines</a>
            </li>
            <li class="footer-nav-item">
              <a href="#" class="footer-nav-link">Pour-Over Equipment</a>
            </li>
            <li class="footer-nav-item">
              <a href="#" class="footer-nav-link">Coffee Grinders</a>
            </li>
            <li class="footer-nav-item">
              <a href="#" class="footer-nav-link">Gift Sets</a>
            </li>
          </ul>

          <ul class="footer-nav-list">
            <li class="footer-nav-item">
              <h2 class="nav-title">Our Company</h2>
            </li>
            <li class="footer-nav-item">
              <a href="#" class="footer-nav-link">Shipping & Delivery</a>
            </li>
            <li class="footer-nav-item">
              <a href="#" class="footer-nav-link">Return Policy</a>
            </li>
            <li class="footer-nav-item">
              <a href="#" class="footer-nav-link">Terms and Conditions</a>
            </li>
            <li class="footer-nav-item">
              <a href="#" class="footer-nav-link">About Us</a>
            </li>
            <li class="footer-nav-item">
              <a href="#" class="footer-nav-link">Secure Payment</a>
            </li>
          </ul>

          <ul class="footer-nav-list">
            <li class="footer-nav-item"><h2 class="nav-title">Contact</h2></li>
            <li class="footer-nav-item flex">
              <div class="icon-box">
                <ion-icon name="location-outline"></ion-icon>
              </div>
              <address class="content">
                123 Coffee Lane Seattle, WA 98101, USA
              </address>
            </li>
            <li class="footer-nav-item flex">
              <div class="icon-box">
                <ion-icon name="call-outline"></ion-icon>
              </div>
              <a href="tel:+12065550123" class="footer-nav-link"
                >(206) 555-0123</a
              >
            </li>
            <li class="footer-nav-item flex">
              <div class="icon-box">
                <ion-icon name="mail-outline"></ion-icon>
              </div>
              <a href="mailto:info@thedailygrind.com" class="footer-nav-link"
                >info@thedailygrind.com</a
              >
            </li>
          </ul>
        </div>
      </div>

      <div class="footer-bottom">
        <div class="container">
          <img
            src="https://i.postimg.cc/43GKnVFF/payment.png"
            alt="payment method"
            class="payment-img"
          />
          <p class="copyright">
            Copyright &copy; <a href="#">The Daily Grind</a> all rights reserved
          </p>
        </div>
      </div>
    </footer>

    <!-- Toast notification container -->
    <div class="toast-container"></div>

    <script
      type="module"
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"
    ></script>

    <!-- Mobile Menu Dropdown Script -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Mobile Menu Dropdown Toggle
        const mobileMenuDropdownBtn = document.querySelector(
          ".mobile-menu-dropdown-btn"
        );
        const mobileMenuDropdown = document.querySelector(
          ".mobile-menu-dropdown"
        );

        if (mobileMenuDropdownBtn && mobileMenuDropdown) {
          mobileMenuDropdownBtn.addEventListener("click", function (event) {
            event.stopPropagation(); // Prevent event bubbling
            mobileMenuDropdown.classList.toggle("active");
          });

          // Close dropdown when clicking outside
          document.addEventListener("click", function (event) {
            if (!event.target.closest(".mobile-menu-dropdown")) {
              mobileMenuDropdown.classList.remove("active");
            }
          });
        }
      });
    </script>

    <!-- Modal Scripts -->
    <script th:src="@{/js/modal.js}"></script>

    <!-- Custom JavaScript for cart functionality -->
    <script th:inline="javascript">
      // Load cart count on page load
      document.addEventListener("DOMContentLoaded", function () {
        // First try to get counts from localStorage for immediate display
        const savedCartCount = localStorage.getItem("cartCount");
        if (savedCartCount) {
          updateCartCount(parseInt(savedCartCount));
        }

        const savedWishlistCount = localStorage.getItem("wishlistCount");
        if (savedWishlistCount) {
          updateWishlistCount(parseInt(savedWishlistCount));
        }

        // Then fetch the actual counts from the server
        loadCartCount();
        loadWishlistCount();

        // Add cart hover functionality
        const cartBtn = document.querySelector(".cart-btn");
        if (cartBtn) {
          cartBtn.addEventListener("mouseenter", loadMiniCartPreview);
        }

        // Add wishlist hover functionality
        const wishlistBtn = document.querySelector(".wishlist-btn");
        if (wishlistBtn) {
          wishlistBtn.addEventListener("mouseenter", loadMiniWishlistPreview);
        }
      });

      // Function to load mini cart preview content
      function loadMiniCartPreview() {
        const miniCartItems = document.querySelector(".mini-cart-items");
        if (!miniCartItems) return;

        // Check if we already loaded this recently (cache for 1 minute)
        const lastLoad = localStorage.getItem("miniCartLastLoad");
        const now = Date.now();
        if (
          lastLoad &&
          now - parseInt(lastLoad) < 60000 &&
          localStorage.getItem("miniCartHtml")
        ) {
          miniCartItems.innerHTML = localStorage.getItem("miniCartHtml");
          return;
        }

        // Show loading
        miniCartItems.innerHTML =
          '<div class="mini-cart-loading">Loading cart items...</div>';

        // Fetch cart items
        fetch("/cart/mini")
          .then((response) => {
            if (!response.ok) {
              throw new Error("Failed to load cart");
            }
            return response.json();
          })
          .then((data) => {
            if (data.items && data.items.length > 0) {
              // Cart has items
              let html = "";
              data.items.forEach((item) => {
                const productName =
                  item.name && item.name !== "null"
                    ? item.name
                    : "Loading product name...";
                html += `
                  <div class="mini-cart-item">
                    <img src="${item.image}" alt="${productName}" class="mini-cart-item-img">
                    <div class="mini-cart-item-details">
                      <h5 class="mini-cart-item-title" data-product-id="${item.id}">${productName}</h5>
                      <p class="mini-cart-item-price">${item.price}</p>
                      <span class="mini-cart-item-qty">Qty: ${item.quantity}</span>
                    </div>
                    <button class="mini-cart-item-remove" onclick="removeFromCart(${item.id})">×</button>
                  </div>
                `;
              });

              // Add subtotal
              html += `
                <div class="mini-cart-subtotal">
                  <span>Subtotal:</span>
                  <strong>${data.subtotal}</strong>
                </div>
              `;

              miniCartItems.innerHTML = html;

              // Cache the result
              localStorage.setItem("miniCartHtml", html);
              localStorage.setItem("miniCartLastLoad", now.toString());

              // Fetch missing product names
              setTimeout(fetchMiniCartProductNames, 100);
            } else {
              // Cart is empty
              miniCartItems.innerHTML =
                '<div class="mini-cart-empty">Your cart is empty</div>';
              localStorage.setItem("miniCartHtml", miniCartItems.innerHTML);
              localStorage.setItem("miniCartLastLoad", now.toString());
            }
          })
          .catch((error) => {
            miniCartItems.innerHTML =
              '<div class="mini-cart-error">Failed to load cart items</div>';
          });
      }

      // Function to remove item from cart
      function removeFromCart(productId) {
        fetch("/cart/remove", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRF-TOKEN": document
              .querySelector('meta[name="_csrf"]')
              ?.getAttribute("content"),
          },
          body: JSON.stringify({ productId }),
        })
          .then((response) => response.json())
          .then((data) => {
            updateCartCount(data.cartCount || 0);
            showToast("Success", "Item removed from cart", "success");

            // Clear cache and reload mini cart
            localStorage.removeItem("miniCartHtml");
            localStorage.removeItem("miniCartLastLoad");
            loadMiniCartPreview();
          })
          .catch((error) => {
            showToast("Error", "Failed to remove item from cart", "error");
          });
      }

      // Function to load the cart count
      function loadCartCount() {
        fetch("/cart/count")
          .then((response) => response.json())
          .then((data) => {
            updateCartCount(data.cartCount || 0);
          })
          .catch((error) => {
            // Silently handle errors in production
            const savedCount = localStorage.getItem("cartCount");
            if (savedCount) {
              updateCartCount(parseInt(savedCount));
            }
          });
      }

      // Function to load wishlist count from server
      function loadWishlistCount() {
        fetch("/wishlist/count")
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then((data) => {
            updateWishlistCount(data.wishlistCount || 0);
          })
          .catch((error) => {
            console.error("Error fetching wishlist count:", error);
            // If fetch fails, at least try to use the localStorage value
            const savedCount = localStorage.getItem("wishlistCount");
            if (savedCount) {
              updateWishlistCount(parseInt(savedCount));
            }
          });
      }

      // Cart functionality
      function addToCart(productId) {
        // Add product to cart using AJAX
        fetch("/cart/add", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRF-TOKEN": document
              .querySelector('meta[name="_csrf"]')
              ?.getAttribute("content"),
          },
          body: JSON.stringify({ productId: productId, quantity: 1 }),
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then((data) => {
            if (data.redirect) {
              // Redirect if needed (e.g., to login page)
              window.location.href = data.redirect;
              return;
            }

            showToast("Success", "Product added to cart!", "success");
            // Use the cartCount from the server response
            if (data.cartCount !== undefined) {
              updateCartCount(data.cartCount);
            }
          })
          .catch((error) => {
            showToast(
              "Error",
              "Failed to add product to cart. Please try again.",
              "error"
            );
          });
      }

      // Wishlist functionality
      function addToWishlist(productId) {
        // Add product to wishlist using AJAX
        fetch("/wishlist/add", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRF-TOKEN": document
              .querySelector('meta[name="_csrf"]')
              ?.getAttribute("content"),
          },
          body: JSON.stringify({ productId: productId }),
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then((data) => {
            if (data.redirect) {
              // Redirect if needed (e.g., to login page)
              window.location.href = data.redirect;
              return;
            }

            showToast("Success", "Product added to wishlist!", "success");
            // Use the wishlistCount from the server response
            if (data.wishlistCount !== undefined) {
              updateWishlistCount(data.wishlistCount);
            }

            // Clear cache to ensure fresh wishlist data
            localStorage.removeItem("miniWishlistHtml");
            localStorage.removeItem("miniWishlistLastLoad");
          })
          .catch((error) => {
            showToast(
              "Error",
              "Failed to add product to wishlist. Please try again.",
              "error"
            );
            console.error("Error:", error);
          });
      }

      // Quick view functionality
      function quickView(productId) {
        // Show product details page
        // You can implement a modal popup to show product details
        window.location.href = "/products/" + productId;
      }

      // Update cart count in UI
      function updateCartCount(count) {
        const countElements = document.querySelectorAll(".count");
        const previousCount = parseInt(
          localStorage.getItem("cartCount") || "0"
        );
        const isIncreasing = count > previousCount;

        // Find all cart badges (both in header and mobile navigation)
        countElements.forEach((element) => {
          const parentButton = element.closest(".action-btn");
          if (
            parentButton &&
            parentButton.querySelector('ion-icon[name="bag-handle-outline"]')
          ) {
            // Update the text
            element.textContent = count;

            // Apply animation
            if (isIncreasing) {
              element.style.animation = "none";
              void element.offsetWidth; // Trigger reflow
              element.style.animation = "cartBadgePulse 1s ease-out";

              // Also animate the cart icon
              const cartIcon = parentButton.querySelector(
                'ion-icon[name="bag-handle-outline"]'
              );
              if (cartIcon) {
                cartIcon.style.animation = "none";
                void cartIcon.offsetWidth;
                cartIcon.style.animation = "addToCartAnimation 0.5s ease-out";
              }
            }

            // Always show the badge, even when count is 0
            element.style.display = "flex";

            // Adjust size based on count
            if (count > 9) {
              element.style.width = "24px";
            } else {
              element.style.width = "22px";
            }
          }
        });

        // Store the cart count in localStorage for persistence
        localStorage.setItem("cartCount", count);

        // Update the cart tooltip if count changes
        updateCartTooltip(count);
      }

      // Update wishlist count in UI
      function updateWishlistCount(count) {
        const countElements = document.querySelectorAll(".count");
        const previousCount = parseInt(
          localStorage.getItem("wishlistCount") || "0"
        );
        const isIncreasing = count > previousCount;

        // Find wishlist badges (both in header and mobile navigation)
        countElements.forEach((element) => {
          const parentButton = element.closest(".action-btn");
          if (
            parentButton &&
            parentButton.querySelector('ion-icon[name="heart-outline"]')
          ) {
            // Update the text
            element.textContent = count;

            // Apply animation
            if (isIncreasing) {
              element.style.animation = "none";
              void element.offsetWidth; // Trigger reflow
              element.style.animation = "cartBadgePulse 1s ease-out";

              // Also animate the wishlist icon
              const wishlistIcon = parentButton.querySelector(
                'ion-icon[name="heart-outline"]'
              );
              if (wishlistIcon) {
                wishlistIcon.style.animation = "none";
                void wishlistIcon.offsetWidth; // Trigger reflow
                wishlistIcon.style.animation =
                  "addToCartAnimation 0.5s ease-out";
              }
            }
          }
        });

        // Store in local storage for persistence
        localStorage.setItem("wishlistCount", count);

        // Update the wishlist tooltip if count changes
        updateWishlistTooltip(count);
      }

      // Update cart tooltip text based on item count
      function updateCartTooltip(count) {
        const tooltips = document.querySelectorAll(".cart-tooltip");
        tooltips.forEach((tooltip) => {
          if (count === 0) {
            tooltip.textContent = "Cart Empty";
          } else if (count === 1) {
            tooltip.textContent = "View Cart (1 item)";
          } else {
            tooltip.textContent = `View Cart (${count} items)`;
          }
        });
      }

      // Update wishlist tooltip text based on item count
      function updateWishlistTooltip(count) {
        const tooltips = document.querySelectorAll(".wishlist-tooltip");
        tooltips.forEach((tooltip) => {
          if (count === 0) {
            tooltip.textContent = "Wishlist Empty";
          } else if (count === 1) {
            tooltip.textContent = "View Wishlist (1 item)";
          } else {
            tooltip.textContent = `View Wishlist (${count} items)`;
          }
        });
      }

      // Show toast notification
      function showToast(title, message, type = "success") {
        const toastContainer = document.querySelector(".toast-container");
        const toast = document.createElement("div");
        toast.className = `toast ${type}`;

        const toastContent = `
          <div class="toast-icon">
            <ion-icon name="${
              type === "success" ? "checkmark-circle" : "alert-circle"
            }"></ion-icon>
          </div>
          <div class="toast-content">
            <div class="toast-title">${title}</div>
            <div class="toast-message">${message}</div>
          </div>
          <button class="toast-close" onclick="this.parentElement.remove()">
            <ion-icon name="close"></ion-icon>
          </button>
        `;

        toast.innerHTML = toastContent;
        toastContainer.appendChild(toast);

        // Auto remove toast after 3 seconds
        setTimeout(() => {
          toast.style.opacity = "0";
          setTimeout(() => {
            toast.remove();
          }, 300);
        }, 3000);
      }

      // Function to fetch missing product names in mini cart
      function fetchMiniCartProductNames() {
        const productNameElements = document.querySelectorAll(
          ".mini-cart-item-title"
        );

        productNameElements.forEach((element) => {
          if (element.textContent.trim() === "Loading product name...") {
            const productId = element.getAttribute("data-product-id");

            if (productId) {
              fetch(`/api/products/${productId}`)
                .then((response) => response.json())
                .then((data) => {
                  if (data.success && data.data && data.data.name) {
                    element.textContent = data.data.name;
                    // Update the cached HTML in localStorage
                    localStorage.setItem(
                      "miniCartHtml",
                      document.querySelector(".mini-cart-items").innerHTML
                    );
                  } else {
                    // If API call fails or returns no name, show category-based name if possible
                    const categoryName =
                      data.data && data.data.category
                        ? data.data.category.name
                        : null;
                    element.textContent = categoryName
                      ? `${categoryName} Product`
                      : "Product";
                    // Update the cached HTML in localStorage
                    localStorage.setItem(
                      "miniCartHtml",
                      document.querySelector(".mini-cart-items").innerHTML
                    );
                  }
                })
                .catch((error) => {
                  console.error(
                    `Error fetching product name for ID ${productId}:`,
                    error
                  );
                  element.textContent = "Product";
                  // Update the cached HTML in localStorage
                  localStorage.setItem(
                    "miniCartHtml",
                    document.querySelector(".mini-cart-items").innerHTML
                  );
                });
            }
          }
        });
      }

      // Function to load mini wishlist preview content
      function loadMiniWishlistPreview() {
        const miniWishlistItems = document.querySelector(
          ".mini-wishlist-items"
        );
        if (!miniWishlistItems) return;

        // Check if we already loaded this recently (cache for 5 minutes)
        const lastLoad = localStorage.getItem("miniWishlistLastLoad");
        const now = Date.now();
        if (
          lastLoad &&
          now - parseInt(lastLoad) < 300000 && // 5 minutes cache
          localStorage.getItem("miniWishlistHtml")
        ) {
          miniWishlistItems.innerHTML =
            localStorage.getItem("miniWishlistHtml");
          return;
        }

        // Show loading
        miniWishlistItems.innerHTML =
          '<div class="mini-wishlist-loading">Loading wishlist items...</div>';

        // Fetch wishlist items
        fetch("/wishlist/mini")
          .then((response) => {
            if (!response.ok) {
              throw new Error("Failed to load wishlist");
            }
            return response.json();
          })
          .then((data) => {
            if (data.items && data.items.length > 0) {
              // Wishlist has items
              let html = "";
              data.items.forEach((item) => {
                html += `
                  <div class="mini-wishlist-item">
                    <img src="${item.image}" alt="${item.name}" class="mini-wishlist-item-img">
                    <div class="mini-wishlist-item-details">
                      <h5 class="mini-wishlist-item-title">${item.name}</h5>
                      <p class="mini-wishlist-item-price">${item.price}</p>
                    </div>
                    <button class="mini-wishlist-item-remove" onclick="removeFromWishlist(${item.id})">×</button>
                  </div>
                `;
              });

              miniWishlistItems.innerHTML = html;

              // Cache the result
              localStorage.setItem("miniWishlistHtml", html);
              localStorage.setItem("miniWishlistLastLoad", now.toString());
            } else {
              // Wishlist is empty
              miniWishlistItems.innerHTML =
                '<div class="mini-wishlist-empty">Your wishlist is empty</div>';
              localStorage.setItem(
                "miniWishlistHtml",
                miniWishlistItems.innerHTML
              );
              localStorage.setItem("miniWishlistLastLoad", now.toString());
            }
          })
          .catch((error) => {
            miniWishlistItems.innerHTML =
              '<div class="mini-wishlist-error">Failed to load wishlist items</div>';
            console.error("Error loading wishlist:", error);
          });
      }

      // Function to remove item from wishlist
      function removeFromWishlist(productId) {
        fetch("/wishlist/remove", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRF-TOKEN": document
              .querySelector('meta[name="_csrf"]')
              ?.getAttribute("content"),
          },
          body: JSON.stringify({ productId }),
        })
          .then((response) => response.json())
          .then((data) => {
            updateWishlistCount(data.wishlistCount || 0);
            showToast("Success", "Item removed from wishlist", "success");

            // Clear cache and reload mini wishlist
            localStorage.removeItem("miniWishlistHtml");
            localStorage.removeItem("miniWishlistLastLoad");
            loadMiniWishlistPreview();
          })
          .catch((error) => {
            showToast("Error", "Failed to remove item from wishlist", "error");
            console.error("Error removing from wishlist:", error);
          });
      }
    </script>

    <!-- Cart Counter Visibility Fix Script -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Make sure cart counters are visible
        const cartCounters = document.querySelectorAll(".cart-counter");
        cartCounters.forEach((counter) => {
          // Make sure cart counters have proper styling
          counter.style.display = "flex";
          counter.style.zIndex = "100";

          // Add animation when count changes
          const currentCount = counter.textContent.trim();
          counter.setAttribute("data-last-count", currentCount);

          // Store initial count for change detection
          window.lastCartCount = currentCount;

          // If count is zero, still show the counter but smaller
          if (currentCount === "0") {
            counter.style.width = "18px";
            counter.style.height = "18px";
            counter.style.fontSize = "10px";
          } else {
            counter.style.width = "22px";
            counter.style.height = "22px";
          }
        });
      });

      // Function to update cart counters
      function updateCartCounter(count) {
        const cartCounters = document.querySelectorAll(".cart-counter");
        cartCounters.forEach((counter) => {
          // Always ensure counter is visible
          counter.style.display = "flex";
          counter.style.zIndex = "100";

          counter.textContent = count;
          counter.classList.add("cart-counter-update");

          // Remove animation class after animation completes
          setTimeout(() => {
            counter.classList.remove("cart-counter-update");
          }, 500);

          // Adjust size based on count digits
          if (count > 9) {
            counter.style.width = "24px";
          } else {
            counter.style.width = count > 0 ? "22px" : "20px";
            counter.style.fontSize = count > 0 ? "12px" : "10px";
          }
        });
      }
    </script>

    <script src="/js/home-product-meta.js"></script>
    <script src="/js/home-product-fetch.js"></script>
    <script>
      // Attach cart/wishlist event listeners after dynamic products are rendered
      document.addEventListener("DOMContentLoaded", function () {
        function delegateEvent(parent, selector, event, handler) {
          parent.addEventListener(event, function (e) {
            const target = e.target.closest(selector);
            if (target) handler(target, e);
          });
        }
        // Wait for products to be rendered
        function setupProductActions() {
          const featuredGrid = document.querySelector(
            ".product-main .product-grid"
          );
          const newArrivals = document.querySelector(
            ".product-minimal .showcase-wrapper .showcase-container"
          );
          // Add additional containers where product buttons might appear (modals, etc.)
          const allContainers = [
            featuredGrid,
            newArrivals,
            document.querySelector(".modal-products"), // For modal product displays
            document.querySelector(".wishlist-items-container"), // For wishlist
          ];

          allContainers.forEach((container) => {
            if (!container) return;
            // Add to Cart - using data attributes instead of onclick
            delegateEvent(
              container,
              '[data-cart-action="add"]',
              "click",
              (btn, e) => {
                e.preventDefault();
                const id = parseInt(btn.getAttribute("data-product-id"));
                addToCart(id);
              }
            );
            // Add to Wishlist
            delegateEvent(
              container,
              '.btn-action[onclick^="addToWishlist"]',
              "click",
              (btn, e) => {
                e.preventDefault();
                const id = parseInt(
                  btn.getAttribute("onclick").match(/\d+/)[0]
                );
                addToWishlist(id);
              }
            );
            // Quick View
            delegateEvent(
              container,
              '.btn-action[onclick^="quickView"]',
              "click",
              (btn, e) => {
                e.preventDefault();
                const id = parseInt(
                  btn.getAttribute("onclick").match(/\d+/)[0]
                );
                quickView(id);
              }
            );
          });
        }
        // Wait for dynamic rendering
        setTimeout(setupProductActions, 500);
      });
    </script>
  </body>
</html>
